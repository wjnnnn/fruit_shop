<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ°´æœç¼¤çº· - æº¯æºä¸­å¿ƒ</title>
  <style>
    /* ç®€å•ç¾è§‚çš„ CSS æ ·å¼ */
    body { font-family: 'PingFang SC', sans-serif; background: #f5f5f5; margin: 0; padding: 0; }
    .header { background: #4CAF50; color: white; padding: 20px; text-align: center; }
    .container { max-width: 600px; margin: -20px auto 20px; padding: 15px; }

    .card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .title { border-left: 4px solid #4CAF50; padding-left: 10px; font-weight: bold; margin-bottom: 10px; color: #333; }

    /* æº¯æºåˆ—è¡¨æ ·å¼ */
    .trace-item { border-bottom: 1px dashed #eee; padding: 10px 0; display: flex; align-items: center; }
    .fruit-icon { font-size: 2em; margin-right: 15px; }
    .fruit-info { flex: 1; }
    .tag { background: #e8f5e9; color: #4CAF50; padding: 2px 6px; border-radius: 4px; font-size: 0.8em; }

    /* å•†å“åˆ—è¡¨æ ·å¼ */
    .shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .shop-item { background: white; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #eee; }
    .btn-buy { background: #ff9800; color: white; border: none; padding: 6px 15px; border-radius: 20px; margin-top: 8px; cursor: pointer; width: 100%; }

    /* å¼¹çª—æ ·å¼ */
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; justify-content: center; align-items: center; }
    .modal-content { background: white; padding: 20px; border-radius: 10px; text-align: center; width: 80%; animation: pop 0.3s; }
    .coupon-box { border: 2px dashed #ff5722; background: #fff3e0; padding: 15px; margin: 10px 0; color: #ff5722; font-weight: bold; font-size: 1.2em; }
    @keyframes pop { from {transform: scale(0.8);} to {transform: scale(1);} }
  </style>
</head>
<body>

<div class="header">
  <h2>ğŸ æ°´æœæº¯æºä¸­å¿ƒ</h2>
  <p>åŒºå—é“¾æŠ€æœ¯æ”¯æŒ Â· å…¨ç¨‹å¯è¿½æº¯</p>
</div>

<div class="container">
  <!-- æº¯æºä¿¡æ¯å¡ç‰‡ -->
  <div class="card">
    <div class="title">ğŸ“¦ æœ¬æ¬¡æ‰«ç æº¯æºä¿¡æ¯</div>
    <div id="trace-list" style="color: #666; font-size: 0.9em; text-align: center; padding: 20px;">
      æ­£åœ¨è¯»å–æ•°æ®...
    </div>
  </div>

  <!-- å•†åŸå¡ç‰‡ -->
  <div class="card">
    <div class="title">ğŸ›’ åœ¨çº¿è¡¥è´§ (æé€Ÿè¾¾)</div>
    <div class="shop-grid" id="shop-list"></div>
  </div>
</div>

<!-- ä¼˜æƒ åˆ¸å¼¹çª— -->
<div id="couponModal" class="modal">
  <div class="modal-content">
    <h3>ğŸ‰ æ­å–œè·å¾—ä¼˜æƒ åˆ¸ï¼</h3>
    <p>æ„Ÿè°¢æ‚¨æ‰«ç æŸ¥éªŒçœŸä¼ª</p>
    <div class="coupon-box">ï¿¥<span id="couponValue">0</span> å…ƒæ— é—¨æ§›åˆ¸</div>
    <button class="btn-buy" style="background:#4CAF50" onclick="closeModal()">å¼€å¿ƒæ”¶ä¸‹</button>
  </div>
</div>

<script>
  // 1. æ°´æœæ•°æ®åº“
  const fruitDB = [
    { id: 0, name: "çº¢å¯Œå£«è‹¹æœ", origin: "å±±ä¸œçƒŸå°", quality: "Açº§", price: 10.5, img: "ğŸ" },
    { id: 1, name: "è¿›å£é¦™è•‰", origin: "å¹¿è¥¿å—å®", quality: "Açº§", price: 5.0, img: "ğŸŒ" },
    { id: 2, name: "å·¨å³°è‘¡è„", origin: "æ–°ç–†åé²ç•ª", quality: "ç‰¹çº§", price: 8.5, img: "ğŸ‡" },
    { id: 3, name: "èµ£å—è„æ©™", origin: "æ±Ÿè¥¿èµ£å—", quality: "Açº§", price: 6.0, img: "ğŸŠ" },
    { id: 4, name: "çš‡å† æ¢¨", origin: "æ²³åŒ—èµµå¿", quality: "ç‰¹çº§", price: 12.0, img: "ğŸ" }
  ];

  // 2. åˆå§‹åŒ–é€»è¾‘
  window.onload = function() {
    const params = new URLSearchParams(window.location.search);

    // --- é€»è¾‘A: è§£ææº¯æºæ•°æ® ---
    const dataStr = params.get('d');
    const traceContainer = document.getElementById('trace-list');

    if (dataStr) {
      traceContainer.innerHTML = "";
      const items = dataStr.split('-');
      items.forEach(item => {
        const [id, weight] = item.split('_');
        const fruit = fruitDB[parseInt(id)];
        if(fruit) {
          traceContainer.innerHTML += `
                        <div class="trace-item">
                            <div class="fruit-icon">${fruit.img}</div>
                            <div class="fruit-info">
                                <div><strong>${fruit.name}</strong></div>
                                <div style="font-size:0.8em; color:#888;">äº§åœ°: ${fruit.origin} | å“è´¨: ${fruit.quality}</div>
                                <div style="font-size:0.8em; color:#4CAF50;">æœ¬æ¬¡è´­ä¹°: ${weight}kg</div>
                            </div>
                            <div class="tag">æ­£å“</div>
                        </div>
                    `;
        }
      });
    } else {
      traceContainer.innerHTML = "æœªæ£€æµ‹åˆ°æ‰«ç æ•°æ®";
    }

    // --- é€»è¾‘B: ä¼˜æƒ åˆ¸æ£€æµ‹ ---
    const couponVal = params.get('coupon');
    if(couponVal) {
      document.getElementById('couponValue').innerText = couponVal;
      document.getElementById('couponModal').style.display = 'flex';
      // å°†ä¼˜æƒ åˆ¸å­˜å…¥æœ¬åœ°å­˜å‚¨ï¼Œä¾›ä¸‹å•é¡µä½¿ç”¨
      localStorage.setItem('my_coupon', couponVal);
    }

    // --- é€»è¾‘C: æ¸²æŸ“å•†åŸ ---
    const shopContainer = document.getElementById('shop-list');
    fruitDB.forEach(fruit => {
      shopContainer.innerHTML += `
                <div class="shop-item">
                    <div style="font-size:2.5em">${fruit.img}</div>
                    <div style="font-weight:bold; margin:5px 0">${fruit.name}</div>
                    <div style="color:#ff5722">ï¿¥${fruit.price}/kg</div>
                    <button class="btn-buy" onclick="goToOrder(${fruit.id})">ç«‹å³ä¸‹å•</button>
                </div>
            `;
    });
  };

  function closeModal() {
    document.getElementById('couponModal').style.display = 'none';
  }

  // è·³è½¬åˆ°ä¸‹å•é¡µï¼Œé€šè¿‡URLä¼ å‚
  function goToOrder(fruitId) {
    window.location.href = `order.html?id=${fruitId}`;
  }
</script>
</body>
</html>
